---
import Button from "./flowbite/button.astro";
---

<div class="pitch-card flex flex-col p-8 rounded-xl flex-grow shadow-xl">
  <h2 class="text-2xl">Contact form</h2>
  <form
    class="p-4 flex flex-col gap-8 needs-validation"
    id="contact-form"
    action="https://api.web3forms.com/submit"
    method="POST"
    data-astro-reload
  >
    <!-- Replace with your Access Key -->
    <input
      type="hidden"
      name="access_key"
      value="abfdadf2-c0cb-42fe-ab04-9bbb15880704"
    />

    <!-- Email -->
    <input
      class="bg-white shadow-xl rounded-xl w-full h-10 p-4"
      placeholder="Email"
      name="email"
      type="email"
      required
    />

    <!-- Subject header -->
    <input
      class="bg-white shadow-xl rounded-xl w-full h-10 p-4"
      placeholder="Subject header"
      name="header"
      type="text"
      required
    />

    <!-- Message -->
    <textarea
      placeholder="Type your message here"
      class="shadow-xl rounded-xl w-full py-4 border-none"
      rows="10"
      name="message"
      required></textarea>

    <!-- hCaptcha Spam Protection -->
    <div class="h-captcha" data-captcha="true"></div>

    <button
      class="text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-10 py-2.5 text-center mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 w-fit mx-auto"
      [disabled]="!form.valid"
      type="submit">Send</button
    >
    <div id="result" class="mt-3 text-center"></div>
  </form>
</div>

<div id="toaster" class="hidden">Message sent successfully!</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("contact-form");
    const result = document.getElementById("result");

    form.addEventListener("submit", function (event) {
      event.preventDefault();
      form.classList.add("was-validated");
      if (!form.checkValidity()) {
        form.querySelectorAll(":invalid")[0].focus();
        return;
      }
      const formData = new FormData(form);
      const object = Object.fromEntries(formData);
      const json = JSON.stringify(object);

      result.innerHTML = "Sending...";

      fetch("https://api.web3forms.com/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
        body: json,
      })
        .then(async (response) => {
          let json = await response.json();
          if (response.status === 200) {
            result.classList.add("text-green-500");
            result.innerHTML = "Message sent successfully!";
          } else {
            console.log(response);
            result.classList.add("text-red-500");
          }
        })
        .catch((error) => {
          console.log(error);
          result.innerHTML = "Something went wrong!";
        })
        .then(() => {
          form.reset();
          form.classList.remove("was-validated");
          setTimeout(() => {
            result.style.display = "none";
          }, 5000);
        });
    });
  });
</script>

<script src="https://web3forms.com/client/script.js" async defer></script>
